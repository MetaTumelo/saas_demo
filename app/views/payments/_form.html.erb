<%= form_tag payments_path, id: 'card-details' do |f| %>
  <div class="payment-errors"></div>
  
  <div class="col-md-4 col-md-offset-4 well">
    <div>
      <label for="card-number">Card Number:</label>
      <input id="card-number" type="text" data-stripe="number" class="form-control card__input card__input_number" name="card_name" placeholder="XXXX XXXX XXXX XXXX" pattern="[0-9]{14,23}" />
    </div>
  
    <div>
      <label for="card-exp-month">Card Expiry Month:</label>
      <input id="card-exp-month" type="text" data-stripe="exp_month" class="form-control" />
      <%= select_month nil, {add_month_numbers_true: true}, {name: nil, id: "card-exp-month"} %>
    </div>
  
    <div>
      <label for="card-exp-year">Card Expiry Year:</label>
      <input id="card-exp-year" type="text" data-stripe="exp_year" class="form-control" />
      <%#= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: "card-exp-year"}%>
    </div>
  
    <div>
      <label for="card-cvc">CVC:</label>
      <input id="card-cvc" type="text" data-stripe="cvc" class="form-control" />
    </div>
  
    <div>
      <label for="payment-type">Payment Type:</label>
      <select id="payment-type" name="payment_type" class="form-control" >
        <option value="deposit">¥20 Deposit</option>
        <option value="subscription">Monthly subscription, ¥9.97</option>
      </select>
    </div>
    <div>
      <input type="submit" value="Pay Now" class="btn btn-success btn-block btn-lg" />
    </div>
  </div>  
<% end %>
<%= stripe_javascript_tag %>
<%= javascript_include_tag 'custom/payments.js', 'data-turbolinks-track' => true %>

<input type="text" id="card__input_number" class="form-control card__input card__input_number" placeholder="XXXX XXXX XXXX XXXX" pattern="[0-9]{14,23}" required autofocus autocomplete="cc-number" name="cardnumber" data-stripe="number">
<input type="text" id="card__input_month" class="form-control card__input card__input_date card__input_month" placeholder="MM" pattern="[0-9]{1,2}" required autocomplete="cc-exp-month" name="ccmonth">
<input type="text" id="card__input_year" class="form-control card__input card__input_date card__input_year" placeholder="YYYY" pattern="[0-9]{2,4}" required autocomplete="cc-exp-year" name="ccyear">
<input type="text" class="form-control card__input card__input_cardholder" placeholder="CARDHOLDER NAME" required autocomplete="cc-name" name="ccname">

<%= javascript_include_tag 'custom/vanilla-masker.min.js', 'data-turbolinks-track' => true %>
<%= javascript_include_tag 'custom/vanilla-masker.js', 'data-turbolinks-track' => true %>

<script>
$(function(){
  // npm install fast-luhn --save
  // import masker from 'vanilla-masker';
  
  // const cardNumber = document.getElementById('card__input_number');
  // const cardMonth = document.getElementById('card__input_month');
  // const cardYear = document.getElementById('card__input_year');
  
  // masker(cardNumber).maskPattern('9999 9999 9999 9999 99');
  // masker(cardMonth).maskPattern('99');
  // masker(cardYear).maskPattern('9999');
  
  // #maskNumber
	VMasker(document.getElementById("card__input_number")).maskNumber();
	VMasker(document.getElementById("card__input_month")).maskNumber();
	VMasker(document.getElementById("card__input_year")).maskNumber();
	// #maskPattern
	VMasker(document.getElementById("card__input_number")).maskPattern('9999 9999 9999 9999');
	VMasker(document.getElementById("card__input_month")).maskPattern('99');
	VMasker(document.getElementById("card__input_year")).maskPattern('9999');
	
	VMasker(document.getElementById("card-number")).maskNumber();
	VMasker(document.getElementById("card-number")).maskPattern('9999 9999 9999 9999');
	
// 	const cardNumber = document.getElementById('card__input_number');
//   cardNumber.addEventListener('input', (event) => {
//     const number = event.target.value;
  
//     if (number.length >= 14) {
//       const isLuhnCheckPassed = luhn(number.split(' ').join(''));
//       cardNumber.classList.toggle('card__input_invalid', !isLuhnCheckPassed);
//       cardNumber.classList.toggle('card__input_valid', isLuhnCheckPassed);
//     } else {
//       cardNumber.classList.remove('card__input_invalid', 'card__input_valid');
//     }
//   });
  
  //Bank details
  // import banksDB from 'banks-db';
  // const bank = banksDB(cardNumberField.value);
  // alert(bank.code);
  // if ( bank.code ) {
  //   billingForm.className = 'billing-form is-' + (bank.code || 'other');
  //   bankName.innerText = bank.country === 'ru' ? bank.localTitle : bank.engTitle;
  // } else {
  //   billingForm.className = 'billing-form';
  //   bankName.innerText = '';
  // }
});
</script>